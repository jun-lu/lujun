MX.extend(MX.kit,function(){function c(b){this.option=b;this.minWidth=200;this.minHeight=100;this.dir=this.oldy=this.oldx=this.top=this.left=this.height=this.width=0}c.prototype={init:function(){var b=this;this.events={r:function(a){b.option.sizeElement.width(this.checkMinWidth(b.width+(a.x-b.oldx)))},b:function(a){b.option.sizeElement.height(this.checkMinHeight(b.height+(a.y-b.oldy)))},br:function(a){b.events.r(a);b.events.b(a)},t:function(a){var d=this.checkMinHeight(b.height+(b.oldy-a.y));b.option.sizeElement.height(d);
d!=b.minHeight&&b.option.sizeElement.css("top",b.top-(b.oldy-a.y))},l:function(a){var d=this.checkMinWidth(b.width+(b.oldx-a.x));b.option.sizeElement.width(d);d!=b.minWidth&&b.option.sizeElement.css("left",b.left-(b.oldx-a.x))},bl:function(a){b.events.l(a);b.events.b(a)},tr:function(a){b.events.t(a);b.events.r(a)},tl:function(a){b.events.t(a);b.events.l(a)},checkMinWidth:function(a){return a<b.minWidth?b.minWidth:a},checkMinHeight:function(a){return a<b.minHeight?b.minHeight:a},move:function(a){b.move(a);
return!1},up:function(a){b.up(a);return!1}};this.setRangeWindow();this.option.dragElements.show().bind("mousedown",function(a){var d=$(this).attr("data-dir");b.replaceProperty(a.screenX,a.screenY,d);b.down();return!1})},replaceProperty:function(b,a,d){var f=this.option.sizeElement,c=f.offset();this.width=f.width();this.height=f.height();this.left=c.left;this.top=c.top;this.oldx=b;this.oldy=a;this.dir=d},down:function(){var b=$(document);this.setRangeWindow();b.bind("mousemove",this.events.move);b.bind("mouseup",
this.events.up);this.onfocus()},move:function(b){if(this.checkBoundary(b.pageX,b.pageY))this.events[this.dir]({x:b.screenX,y:b.screenY})},checkBoundary:function(b,a){var d=this.option.range;return b<d[0]||a<d[1]||b>d[2]||a>d[3]?!1:!0},up:function(){var b=$(document);b.unbind("mousemove",this.events.move);b.unbind("mouseup",this.events.up);var b=this.option.sizeElement,a=b.offset();this.width=b.width();this.height=b.height();this.left=a.left;this.top=a.top;this.onblur(this.width,this.height,this.left,
this.top)},setRangeWindow:function(){var b=$(window).scrollTop(),a=$(window).scrollLeft(),d=$(window).width()+a-5,c=$(window).height()+b-5;this.option.range=[a+5,b+5,d,c]},onfocus:function(){},onblur:function(){}};return{Resize:c}}());MX.extend(MX.kit,function(){function c(b){var a={dragElement:null,moveElement:null,isRange:!0,isResize:!0,patchWidth:0,patchHeight:0,patchTop:0,patchLeft:0};this.left=this.top=this.height=this.width=0;$.extend(a,b);this.option=a;this.events={}}c.prototype={init:function(){var b=this;this.option.iscap=this.option.dragElement[0].setCapture?!0:!1;$.extend(this.events,{down:function(a){b.down(a);return!1},up:function(a){b.up(a);return!1},move:function(a){b.move(a);return!1}});this.zIndex();this.createMask();
this.option.isRange&&!this.option.range&&this.setRangeWindow();this.start();this.setResize();this.onready()},zIndex:function(){this.minzIndex=this.option.dragElement.css("z-index")||10},createMask:function(){this.mask=$('<div style="position:fixed;display:none;top:0;left:0;opacity:0;background:#000;filter:alpha(opacity=0)"></div>');this.setMask(0,0,$(window).width(),$(window).height(),this.minzIndex+1);$("#mxDialogWarp").append(this.mask)},showMask:function(){this.mask.show()},hideMask:function(){this.mask.hide()},
removeMask:function(){this.mask.remove()},setMask:function(b,a,d,c,e){this.mask.css({top:b,left:a,width:d,height:c,"z-index":e})},setMaskIndex:function(b){this.mask.css("z-index",b||MX.ui.Dialog.index)},start:function(){this.option.dragElement.bind("mousedown",this.events.down)},down:function(b){var a=this.option.dragElement,d=this.option.moveElement,c=$(document),e=d.offset();this.width=d.width();this.height=d.height();this.setRangeWindow();this.option.iscap&&a[0].setCapture();this.offset={x:b.screenX-
e.left,y:b.screenY-e.top};this.showMask();c.bind("mousemove",this.events.move);c.bind("mouseup",this.events.up);this.onfocus(b.screenX,b.screenY)},move:function(b){var a=this.option.moveElement,d=this.offset,c=b.screenX-d.x-$(window).scrollLeft(),b=b.screenY-d.y-$(window).scrollTop();if(this.option.isRange)b=this.checkBoundary(c,b),c=b.x,b=b.y;this.left=c;this.top=b;a[0].style.left=c+"px";a[0].style.top=b+"px";this.onmove(c,b)},up:function(){var b=$(document),a=this.option.dragElement;this.option.iscap&&
a[0].releaseCapture();this.hideMask();b.unbind("mousemove",this.events.move);b.unbind("mouseup",this.events.up);this.onblur()},stop:function(){this.removeMask()},checkBoundary:function(b,a){var d=this.option.range;$("#movebox").text(d[3]+"-"+this.height);b=b>d[2]-this.width?d[2]-this.width:b;a=a>d[3]-this.height?d[3]-this.height:a;b=b<d[0]?d[0]:b;a=a<d[1]?d[1]:a;return{x:b,y:a}},setResize:function(){var b=this;if(!this.option.isResize)return this.option.moveElement.find(".mx-dialog-change").hide(),
!1;this.resize=new MX.kit.Resize({dragElements:this.option.moveElement.find(".mx-dialog-change"),sizeElement:this.option.moveElement});this.resize.onfocus=function(){b.showMask();b.setMaskIndex()};this.resize.onblur=function(a,d,c,e){b.width=a;b.height=d;b.top=e;b.left=c;b.onResize();b.hideMask()};this.resize.init()},setRange:function(b,a,d,c){this.option.range=[b,a,d,c]},setRangeWindow:function(){var b=this.option.patchTop,a=this.option.patchLeft,d=$(window).width()-this.option.patchWidth,c=$(window).height()-
this.option.patchHeight;this.option.range=[a,b,d,c];this.setMask(0,0,d,c,this.minzIndex)},onfocus:function(){},onblur:function(){},onmove:function(){},onexit:function(){},onready:function(){},onResize:function(){}};return{DragElement:c}}());MX.extend(MX.ui,function(){function c(a){this.isMax=!1;this.isClose=!0;this.isResize=this.isMaximize=!1;this.isMask=this.isMove=!0;this.title="MoXian.com";this.height=this.width=this.minHeight=this.minWidth=100;this.bottom=this.right=this.left=this.top="auto";this.overflow=!0;this.i=c.count++;this.index=c.index++;this.skin="default";this.html=this.url=null;this.ui={};$.extend(this,a);this.skinConfig=$.extend({patchWidth:0,patchHeight:0,patchLeft:0,patchRight:0},b[this.skin]||{})}var b={"default":{patchWidth:1,
patchHeight:2,patchTop:36,patchLeft:1},classical:{patchWidth:7,patchHeight:7,patchTop:42,patchLeft:7}};c.dialogList=[];c.count=1;c.index=100;c.lang={cn:{home:"\u4e3b\u9875",maximize:"\u6700\u5927\u5316",restore:"\u8fd8\u539f",close:"\u5173\u95ed"},en:{home:"Home",maximize:"Maximize",restore:"Restore",close:"Close"}};c.lang.currentLang=c.lang.cn;c.prototype={getTpl:function(){var a=c.lang.currentLang;return'<div class="mx-dialog mx-dialog-<%=kind%> mx-dialog-<%=skin%>" id="mxDialog_<%=i%>" style="width:<%=__widthpx%>;height:<%=__heightpx%>;left:<%=left%>px;top:<%=top%>px;right:<%=right%>px;bottom:<%=bottom%>px;z-index:<%=index%>">\t\t\t\t<div class="mx-dialog-skin-bg"></div>\t\t\t\t<div class="mx-dialog-skin">\t\t\t\t\t<div class="mx-dialog-t mx-dialog-change" style="display:none;" data-dir="t"></div>\t\t\t\t\t<div class="mx-dialog-b mx-dialog-change" style="display:none;" data-dir="b"></div>\t\t\t\t\t<div class="mx-dialog-r mx-dialog-change" style="display:none;" data-dir="r"></div>\t\t\t\t\t<div class="mx-dialog-l mx-dialog-change"  style="display:none;" data-dir="l"></div>\t\t\t\t\t<div class="mx-dialog-tr mx-dialog-change"  style="display:none;" data-dir="tr"></div>\t\t\t\t\t<div class="mx-dialog-tl mx-dialog-change" style="display:none;" data-dir="tl"></div>\t\t\t\t\t<div class="mx-dialog-br mx-dialog-change" style="display:none;" data-dir="br"></div>\t\t\t\t\t<div class="mx-dialog-bl mx-dialog-change" style="display:none;" data-dir="bl"></div>\t\t\t\t\t<div class="mx-dialog-title"><div class="mx-dialog-title-in">\t\t\t\t\t\t<div class="mx-dialog-tool"><a href="###" class="mx-dialog-home" title="'+
a.home+'"></a></div>\t\t\t\t\t\t<h1 class="mx-dialog-h1"><%=title%></h1>\t\t\t\t\t\t<div class="mx-dialog-buttons">\t\t\t\t\t\t\t<%if(isMaximize){%>\t\t\t\t\t\t\t\t<a href="###" class="mx-dialog-maximize" title="'+a.maximize+'"></a>\t\t\t\t\t\t\t\t<a href="###" class="mx-dialog-restore" style="display:none;" title="'+a.restore+'"></a>\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t<%if(isClose){%>\t\t\t\t\t\t\t\t<a href="###" class="mx-dialog-close" title="'+a.close+'"></a>\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t</div></div>\t\t\t\t\t<div class="mx-dialog-content" style="height:100%;left:0;top:0;">\t\t\t\t\t\t<%if(html != null){%>\t\t\t\t\t\t\t<%=html%>\t\t\t\t\t\t<%}else{%>\t\t\t\t\t\t\t<iframe class="mx-dialog-iframe" src="<%=url%>" hidefocus frameborder="no" allowtransparency="true" height="100%" width="100%"></iframe>\t\t\t\t\t\t<%}%>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>'},
init:function(){if(this.url)this.kind="url",this.__widthpx=this.width+"px",this.__heightpx=this.height+"px";else if(this.html)this.kind="html",this.__heightpx=this.__widthpx="auto";this.updatePos();var a=Common.tmpl(this.getTpl(),this);this.ui.dialogWarp=this.createDialogWarp();this.ui.dialogWarp.append(a);this.ui.mxDialog=$("#mxDialog_"+this.i);$.extend(this.ui,{maximize:this.ui.mxDialog.find(".mx-dialog-maximize"),restore:this.ui.mxDialog.find(".mx-dialog-restore"),close:this.ui.mxDialog.find(".mx-dialog-close"),
context:this.ui.mxDialog.find(".mx-dialog-content"),iframe:this.ui.mxDialog.find(".mx-dialog-iframe"),title:this.ui.mxDialog.find(".mx-dialog-title"),h1:this.ui.mxDialog.find(".mx-dialog-h1"),home:this.ui.mxDialog.find(".mx-dialog-home")});if(this.html)this.width=this.ui.context.width()+2,this.height=this.ui.context.height(),this.updatePos(),this.setPos(this.top,this.left,this.width,this.height);this.overflow==!1&&this.ui.iframe.attr("scrolling","no");this.isMove&&this.drag();this.regEvents();this.mask();
c.dialogList.push(this);this.onready()},regEvents:function(){var a=this;this.ui.maximize.click(function(){a.setMaximize();return!1});this.ui.restore.click(function(){a.setRestore();return!1});this.ui.close.click(function(){a.setClose();return!1});this.ui.home.click(function(){a.setGohome();return!1});this.ui.h1.mousedown(function(){a.setFocus();return!1});this.winresize=function(){a.isMax&&a.setMaximize()};$(window).resize(this.winresize)},updatePos:function(){if(!(this.right!="auto"||this.bottom!=
"auto"))this.left=="auto"||this.top=="auto"?(this.top=($(window).height()-this.height)/2,this.left=($(window).width()-this.width)/2):(this.top=this.top<this.skinConfig.patchTop?this.skinConfig.patchTop:this.top,this.left=this.left<this.skinConfig.patchLeft?this.skinConfig.patchLeft:this.left)},drag:function(){var a=this;this.drag=new MX.kit.DragElement($.extend({dragElement:this.ui.h1,moveElement:this.ui.mxDialog,isResize:this.isResize,isRange:this.isRange},this.skinConfig));this.drag.onready=function(){var a=
this;$(window).resize(function(){a.setRangeWindow()})};this.drag.onblur=function(){a.top=this.top;a.left=this.left};this.drag.onResize=function(){a.width=this.width;a.height=this.height;a.top=this.top;a.left=this.left};this.drag.init()},createDialogWarp:function(){var a=$("#mxDialogWarp");if($("#mxDialogWarp").size())return a;a=$('<div class="mx-dialog-warp" id="mxDialogWarp"></div>');$(document.body).append(a);return a},mask:function(){if(this.isMask)if($("#mxDialogMask").size())this.ui.maskElement=
$("#mxDialogMask");else{$(document.body).height();var a=$('<div style="background:black;width:100%;height:100%;position:fixed;z-index:99;opacity:.5;top:0;left:0;filter:alpha(opacity=50);-moz-opacity:.5;" id="mxDialogMask"></div>');this.ui.dialogWarp.append(a);this.ui.maskElement=a}else this.ui.maskElement=$("#mxDialogMask")},removeMask:function(){this.ui.maskElement.remove()},setPos:function(a,b,c,e){this.ui.mxDialog.css({width:c+"px",height:e+"px",top:a+"px",left:b+"px"});this.onresize()},setRemove:function(){this.ui.mxDialog.remove()},
setClose:function(){this.ui.mxDialog.hide();this.setRemove();this.drag&&this.drag.stop();for(var a=0;a<c.dialogList.length;a++)if(c.dialogList[a]==this){c.dialogList.splice(a,1);break}c.dialogList.length==0&&this.removeMask();$(window).unbind("resize",this.winresize);this.onclose()},setOpen:function(){this.ui.mxDialog.show()},setRefresh:function(){},setGohome:function(){this.ui.iframe[0].src=this.url+"?"+(new Date).getTime()},setRestore:function(){this.isMax=!1;this.setPos(this.top,this.left,this.width,
this.height);this.ui.restore.hide();this.ui.maximize.show()},setMaximize:function(){var a=$(window).width(),b=$(window).height();this.isMax=!0;this.setPos(this.skinConfig.patchTop,this.skinConfig.patchLeft,a-this.skinConfig.patchWidth,b-this.skinConfig.patchHeight-36);this.ui.maximize.hide();this.ui.restore.show()},setFocus:function(){this.ui.mxDialog.css("z-index",c.index++);this.drag&&this.drag.setMaskIndex(c.index)},onclose:function(){},onready:function(){},onresize:function(){}};return{Dialog:c}}());try{if(user_info.mx_lang=="en")MX.mxDialog.lang.currentLang=mxDialog.lang.en;if(user_info.mx_lang=="zh")MX.mxDialog.lang.currentLang=mxDialog.lang.cn}catch(e$$22){};
